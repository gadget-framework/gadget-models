# ---------------------------------------------------------------------
Sys.setenv(GADGET_WORKING_DIR=normalizePath(gd$dir))
callGadget(s=1,log = 'init.log') #ignore.stderr = FALSE,

## update the input parameters of vendace with some initial guesses
read.gadget.parameters(sprintf('%s/params.out',gd$dir)) %>% 
  ## init_guess('ven.rec.[0-9]',1,0.001,1000,1) %>%
  ## init_guess('venimm.init.[0-9]',1,0.001,1000,1) %>%
  ## init_guess('venmat.init.[0-9]',1,0.001,1000,1) %>%
  init_guess('rec.[0-9]|init.[0-9]',1,0.001,100,1) %>%
  init_guess('ven.recl',9,5,15,1) %>% 
  init_guess('ven.rec.sd',1.1, 0.01, 15,1) %>% 
  init_guess('ven.Linf',16.31, 12, 25,0) %>% 
  init_guess('ven.k$',47, 0.1, 100,1) %>% 
  init_guess('ven.bbin',0.9, 0.001, 50, 1) %>% 
  init_guess('ven.com1.alpha', 0.9,  0.01, 3, 1) %>% 
  init_guess('ven.com1.l50',12,2,20,1) %>% 
  init_guess('ven.com2.alpha', 0.9,  0.01, 3, 1) %>% 
  init_guess('ven.com2.l50',12,2,20,1) %>% 
  ## init_guess('ven.ref.alpha', 0.9,  0.01, 3, 0) %>% 
  ## init_guess('ven.ref.l50',12,2,20,1) %>% 
  init_guess('ven.aco.alpha', 0.7,  0.01, 3, 1) %>% 
  init_guess('ven.aco.l50',11.5,2,20,1) %>% 
  init_guess('ven.sea.alpha', 0.7,  0.01, 3, 0) %>% 
  init_guess('ven.sea.l50',11.5,2,20,1) %>% 
  init_guess('venimm.walpha',lw.constants.ven$a, 1e-10, 1,0) %>% 
  init_guess('venimm.wbeta',lw.constants.ven$b, 2, 4,0) %>% 
  init_guess('venmat.walpha',lw.constants.ven$a, 1e-10, 1,0) %>% 
  init_guess('venmat.wbeta',lw.constants.ven$b, 2, 4,0) %>% 
  init_guess('venimm.M$',0.2,0.001,1,0) %>% 
  init_guess('venmat.M$',0.2,0.001,1,0) %>% 
  init_guess('ven.rec.scalar',1e3,1,1e8,0) %>% 
  init_guess('venimm.init.scalar',1e3,1,1e8,0) %>% 
  init_guess('venmat.init.scalar',1e3,1,1e8,0) %>% 
  init_guess('ven.mat2',mat.constants.ven$l50,1,30,1) %>% 
  init_guess('ven.mat1',mat.constants.ven$a,0.1,10,1) %>% # -0.2589 by Mikaela***
  init_guess('ven.init.F',0.3,0.1,1,0) %>%

## update the input parameters of ringed seal with some initial guesses
## read.gadget.parameters(sprintf('%s/params.in',gd$dir)) %>% 
  ## init_guess('rin.rec.[0-9]',1,0.001,1000,1) %>%
  ## init_guess('rinimm.init.[0-9]',1,0.001,1000,1) %>%
  ## init_guess('rinmat.init.[0-9]',1,0.001,1000,1) %>%
  ## init_guess('rec.[0-9]|init.[0-9]',1,0.01,100,1) %>%
  ## init_guess('init.[0-9]',1,0.01,100,1) %>%
  init_guess('rinimm.init.1',init.pop$Nimm[2],0,1000,0) %>%
  init_guess('rinimm.init.2',init.pop$Nimm[3],0,1000,0) %>%
  init_guess('rinimm.init.3',init.pop$Nimm[4],0,1000,0) %>%
  init_guess('rinimm.init.4',init.pop$Nimm[5],0,1000,0) %>%
  init_guess('rinimm.init.5',init.pop$Nimm[6],0,1000,0) %>%
  init_guess('rinmat.init.4',init.pop$Nmat[5],0,1000,0) %>%
  init_guess('rinmat.init.5',init.pop$Nmat[6],0,1000,0) %>%
  init_guess('rinmat.init.6',init.pop$Nmat[7],0,1000,0) %>%
  init_guess('rinmat.init.7',init.pop$Nmat[8],0,1000,0) %>%
  init_guess('rinmat.init.8',init.pop$Nmat[9],0,1000,0) %>%
  init_guess('rinmat.init.9',init.pop$Nmat[10],0,1000,0) %>%
  init_guess('rinmat.init.10',init.pop$Nmat[11],0,1000,0) %>%
  init_guess('rinmat.init.11',init.pop$Nmat[12],0,1000,0) %>%
  init_guess('rinmat.init.12',init.pop$Nmat[13],0,1000,0) %>%
  init_guess('rinmat.init.13',init.pop$Nmat[14],0,1000,0) %>%
  init_guess('rinmat.init.14',init.pop$Nmat[15],0,1000,0) %>%
  init_guess('rinmat.init.15',init.pop$Nmat[16],0,1000,0) %>%
  init_guess('rinmat.init.16',init.pop$Nmat[17],0,1000,0) %>%
  init_guess('rinmat.init.17',init.pop$Nmat[18],0,1000,0) %>%
  init_guess('rinmat.init.18',init.pop$Nmat[19],0,1000,0) %>%
  init_guess('rinmat.init.19',init.pop$Nmat[20],0,1000,0) %>%
  init_guess('rinmat.init.20',init.pop$Nmat[21],0,1000,0) %>%
  init_guess('rinmat.init.21',init.pop$Nmat[22],0,1000,0) %>%
  init_guess('rinmat.init.22',init.pop$Nmat[23],0,1000,0) %>%
  init_guess('rinmat.init.23',init.pop$Nmat[24],0,1000,0) %>%
  init_guess('rinmat.init.24',init.pop$Nmat[25],0,1000,0) %>%
  init_guess('rinmat.init.25',init.pop$Nmat[26],0,1000,0) %>%
      
  init_guess('rin.recl',75,50,90,0) %>% 
  init_guess('rin.rec.sd',7,4,10,0) %>% 
  init_guess('rin.Linf',grw.constants.rin$Linf, 120, 180, 0) %>% 
  init_guess('rin.k$',grw.constants.rin$k*100, 0.1, 100, 0) %>% 
  init_guess('rin.bbin',0.9, 0.001, 50, 0) %>% 
  init_guess('rin.hun.alpha', 0.9,  0.01, 3, 0) %>% 
  init_guess('rin.hun.l50',100,70,120,0) %>% 
  init_guess('rin.aco.alpha',1,0.1,10,0) %>% 
  ## init_guess('rin.com2.alpha', 0.9,  0.01, 3, 1) %>% 
  ## init_guess('rin.com2.l50',12,2,20,1) %>% 
  ## init_guess('rin.ref.alpha', 0.9,  0.01, 3, 0) %>% 
  ## init_guess('rin.ref.l50',12,2,20,1) %>% 
  ## init_guess('rin.aco.alpha', 0.7,  0.01, 3, 0) %>% 
  ## init_guess('rin.aco.l50',11.5,2,20,1) %>% 
  ## init_guess('rin.sea.alpha', 0.7,  0.01, 3, 0) %>% 
  ## init_guess('rin.sea.l50',11.5,2,20,1) %>% 
  init_guess('rinimm.walpha',lw.constants.rin$a, 1e-10, 1,0) %>% 
  init_guess('rinimm.wbeta',lw.constants.rin$b, 2, 4,0) %>% 
  init_guess('rinmat.walpha',lw.constants.rin$a, 1e-10, 1,0) %>%
  init_guess('rinmat.wbeta',lw.constants.rin$b, 2, 4,0) %>% 
  init_guess('rin.spw.mu', sr.mu.rin, 1, 100, 0) %>% 
  init_guess('rin.spw.la', sr.la.rin, 1, 1000, 1) %>% 
  init_guess('rinimm.M$',0.12,0.001,1,0) %>% # 65-89% survival rate pup-subadults (Sundqvist et al 2012 Ambio)
  init_guess('rinmat.M$',0.05129,0.001,1,0) %>% # approx 95% survival rate (Sundqvist et al 2012 Ambio)
  ## init_guess('rin.rec.scalar',1e-2,1e-4,1,0) %>% 
  init_guess('rin.init.scalar',1e2,1e-2,1e2,1) %>% 
  ## init_guess('rinimm.init.scalar',1e2,1e-2,1e2,1) %>% 
  ## init_guess('rinmat.init.scalar',1e2,1e-2,1e2,1) %>% 
  init_guess('rin.mat2',mat.constants.rin$l50,90,130,0) %>% 
  init_guess('rin.mat1',mat.constants.rin$a,0.1,5,0) %>%

  init_guess('over.rinher',0.5,0,1,0) %>% # proportion GoB herring pop available to ringed seal
      
  ## init_guess('rin.init.F',0.1,0.01,1,0) %>%
  init_guess('p0rin2ven',70,1,100,0) %>%
  init_guess('p1rin2ven',1,0.1,10,0) %>%
  init_guess('p2rin2ven',0.2,0.1,10,0) %>%
  init_guess('p0rin2her',0.1,0.01,1,0) %>%
  init_guess('p0rin2oth',0.2,0.1,10,0) %>%
  init_guess('prefrin2ven',1,0.1,10,0) %>%
  init_guess('prefrin2her',1,0.1,10,0) %>%
  init_guess('prefrin2oth',1,0.1,10,0) %>%
  init_guess('m0rin',6,0.1,10,0) %>%
  init_guess('m1rin',0,0,1,0) %>%
  init_guess('m2rin',0,0,1,0) %>%
  init_guess('m3rin',1.8,0.1,10,0) %>%
  init_guess('rin.Hfeed',0,0,10,0) %>%
      
write.gadget.parameters(.,file=sprintf('%s/params.in',gd$dir))
